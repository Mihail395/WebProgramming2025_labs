<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <title>All Dishes</title>
  <style>
    body {
      width: 800px;
      margin: auto;
      font-family: Arial, sans-serif;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    table, td, th {
      border: 1px solid black;
      padding: 10px;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    button {
      margin: 2px;
    }
    .add-button {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<h1>All Dishes</h1>

<!-- Optional error message -->
<p th:if="${error}" th:text="${error}" style="color:red;"></p>

<!-- Show Login if not authenticated -->
<div sec:authorize="!isAuthenticated()">
  <a th:href="@{/login}"><button type="button">Login</button></a>
</div>

<!-- Show Logout if authenticated -->
<div sec:authorize="isAuthenticated()">
  <form th:action="@{/logout}" method="post">
    <button type="submit">Logout</button>
  </form>
</div>

<table>
  <tr>
    <th>Name</th>
    <th>Cuisine</th>
    <th>Prep Time</th>
    <th>Actions</th>
  </tr>

  <tr th:each="dish : ${dishes}">
    <td th:text="${dish.name}"></td>
    <td th:text="${dish.cuisine}"></td>
    <td th:text="${dish.preparationTime} + ' min'"></td>
    <td>
      <div sec:authorize="hasRole('ADMIN')">
      <!-- Edit button -->
      <a th:href="@{'/dishes/dish-form/' + ${dish.id}}">
        <button type="button">Edit</button>
      </a>

      <!-- Delete button -->
      <form th:action="@{'/dishes/delete/' + ${dish.id}}" method="post" style="display:inline;">
        <button type="submit">Delete</button>
      </form>
      </div>
    </td>
  </tr>
</table>

<!-- Add new dish button -->
<div sec:authorize="hasRole('ADMIN')">
<a th:href="@{/dishes/dish-form}" class="add-button">
  <button type="button">Add New Dish</button>
</a>
</div>

<div sec:authorize="isAuthenticated()" style="margin-top: 20px;">
  <a th:href="@{/chefs}">
    <button type="button">Add Dish to Chef</button>
  </a>
</div>

</body>
</html>
