<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <title>Manage Chefs</title>
    <style>
        body { width: 800px; margin: auto; font-family: Arial, sans-serif; }
        h1 { color: #333; }
        .chef-option { margin-bottom: 10px; }
        .actions { display: inline-block; margin-left: 15px; }
        .actions button { margin-right: 5px; cursor: pointer; }
        .add-button { margin-top: 20px; }
        .detail-button { margin-top: 10px; }
    </style>
    <script>
        function deleteChef(chefId) {
            if(confirm("Are you sure you want to delete this chef?")) {
                fetch('/chefs/delete/' + chefId, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                }).then(() => {
                    window.location.reload(); // reload page to show updated list
                });
            }
        }
    </script>
</head>
<body>
<header>
    <h1>Manage Chefs</h1>
</header>
<main>
    <p th:if="${error}" th:text="${error}" style="color:red;"></p>

    <!-- Add New Chef Button -->
    <div sec:authorize="hasRole('ADMIN')">
    <a th:href="@{/chefs/chef-form}" class="add-button">
        <button type="button">Add New Chef</button>
    </a>
    </div>

    <!-- See Chef Details Button -->
    <form th:action="@{/chefs/view-details}" method="get" class="detail-button">
        <input type="hidden" name="chefId" th:value="${#lists.isEmpty(chefs) ? 0 : chefs[0].id}" id="selectedChefId">
        <input type="submit" value="See Chef Details">
    </form>

    <h2>Select a chef:</h2>
    <form th:action="@{/dishes/add-to-chef}" method="get">
        <div th:each="chef : ${chefs}" class="chef-option">
            <input type="radio" name="chefId" th:value="${chef.id}" required
                   th:onclick="'document.getElementById(\'selectedChefId\').value=' + ${chef.id}">
            <span th:text="'Name: ' + ${chef.firstName} + ' ' + ${chef.lastName} + ', Bio: ' + ${chef.bio}"></span>
            <span class="actions" sec:authorize="hasRole('ADMIN')">
                <a th:href="@{'/chefs/chef-form/' + ${chef.id}}">
                    <button type="button">Edit</button>
                </a>
                <button type="button" th:onclick="'deleteChef(' + ${chef.id} + ')'">Delete</button>
            </span>
        </div>
        <br/>
        <input type="submit" value="Add Dish to Chef">
    </form>
</main>
</body>
</html>
